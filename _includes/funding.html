{% assign funding_total = 0 %}
{% assign funding_count = 0 %}
{% for rg in site.data.rafael.funding.doe %}
{% assign amount_clean = rg.amount | replace: "$", "" | replace: ",", "" | replace: "€", "" | replace: " ", "" %}
{% assign funding_total = funding_total | plus: amount_clean %}
{% assign funding_count = funding_count | plus: 1 %}
{% endfor %}
{% for rg in site.data.rafael.funding.nsf %}
{% assign amount_clean = rg.amount | replace: "$", "" | replace: ",", "" | replace: "€", "" | replace: " ", "" %}
{% assign funding_total = funding_total | plus: amount_clean %}
{% assign funding_count = funding_count | plus: 1 %}
{% endfor %}
{% for rg in site.data.rafael.funding.darpa %}
{% assign amount_clean = rg.amount | replace: "$", "" | replace: ",", "" | replace: "€", "" | replace: " ", "" %}
{% assign funding_total = funding_total | plus: amount_clean %}
{% assign funding_count = funding_count | plus: 1 %}
{% endfor %}
{% for rg in site.data.rafael.funding.international %}
{% assign amount_clean = rg.amount | replace: "$", "" | replace: ",", "" | replace: "€", "" | replace: " ", "" %}
{% assign funding_total = funding_total | plus: amount_clean %}
{% assign funding_count = funding_count | plus: 1 %}
{% endfor %}
{% assign funding_total_millions = funding_total | times: 0.000001 | round: 1 %}

<section class="page-section funding-page" data-id="funding">

    <div class="section-inner funding-shell">

        <div class="funding-hero">
            <div class="funding-head">
                <h2 class="section-title">Funding Awards</h2>
                <p class="section-lede">
                    A portfolio of competitively funded programs across U.S. agencies and
                    international collaborations.
                </p>
            </div>
            <div class="funding-metrics">
                <div class="funding-metric">
                    <div class="metric-label">Total awards</div>
                    <div class="metric-value">{{ funding_count }}</div>
                </div>
                <div class="funding-metric">
                    <div class="metric-label">Gross funding</div>
                    <div class="metric-value">${{ funding_total_millions }}M</div>
                </div>
            </div>
        </div>

        <div class="funding-grid">
            <section class="funding-section">
                <div class="funding-header">
                    <div>
                        <h3>U.S. Department of Energy (DOE)</h3>
                        <p class="funding-kicker">Major federally funded initiatives and collaborative programs.</p>
                    </div>
                    <span class="funding-count">{{ site.data.rafael.funding.doe | size }} awards</span>
                </div>
                <div class="funding-list">
                    {% for n in site.data.rafael.funding.doe %}
                    <div class="funding-item">
                        <div class="funding-period">{{ n.period }}</div>
                        <div class="funding-body">
                            {% if n.link %}
                            <a class="funding-title" href="{{ n.link }}" target="_blank">{{ n.title }}</a>
                            {% else %}
                            <div class="funding-title">{{ n.title }}</div>
                            {% endif %}
                            <div class="funding-meta">
                                <span class="funding-amount">{{ n.amount }}</span>
                                {% if n.role %}<span>— {{ n.role }}</span>{% endif %}
                            </div>
                            <div class="funding-meta">
                                {{ n.program }}{% if n.award %} &ndash; Award #{{ n.award }}{% endif %}
                            </div>
                            {% if n.awards %}
                            <div class="funding-awards">
                                {% for d in n.awards %}
                                <span>#{{ d.id }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>

            <section class="funding-section">
                <div class="funding-header">
                    <div>
                        <h3>U.S. National Science Foundation (NSF)</h3>
                        <p class="funding-kicker">Competitive awards supporting foundational research.</p>
                    </div>
                    <span class="funding-count">{{ site.data.rafael.funding.nsf | size }} awards</span>
                </div>
                <div class="funding-list">
                    {% for n in site.data.rafael.funding.nsf %}
                    <div class="funding-item">
                        <div class="funding-period">{{ n.period }}</div>
                        <div class="funding-body">
                            {% if n.link %}
                            <a class="funding-title" href="{{ n.link }}" target="_blank">{{ n.title }}</a>
                            {% else %}
                            <div class="funding-title">{{ n.title }}</div>
                            {% endif %}
                            <div class="funding-meta">
                                <span class="funding-amount">{{ n.amount }}</span>
                                <span>— {{ n.program }}</span>
                            </div>
                            {% if n.awards %}
                            <div class="funding-awards">
                                {% for d in n.awards %}
                                <span>#{{ d.id }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>

            <section class="funding-section">
                <div class="funding-header">
                    <div>
                        <h3>U.S. Defense Advanced Research Projects Agency (DARPA)</h3>
                        <p class="funding-kicker">High-impact, mission-driven research programs.</p>
                    </div>
                    <span class="funding-count">{{ site.data.rafael.funding.darpa | size }} awards</span>
                </div>
                <div class="funding-list">
                    {% for n in site.data.rafael.funding.darpa %}
                    <div class="funding-item">
                        <div class="funding-period">{{ n.period }}</div>
                        <div class="funding-body">
                            {% if n.link %}
                            <a class="funding-title" href="{{ n.link }}" target="_blank">{{ n.title }}</a>
                            {% else %}
                            <div class="funding-title">{{ n.title }}</div>
                            {% endif %}
                            <div class="funding-meta">
                                <span class="funding-amount">{{ n.amount }}</span>
                                <span>— {{ n.program }}</span>
                            </div>
                            {% if n.awards %}
                            <div class="funding-awards">
                                {% for d in n.awards %}
                                <span>#{{ d.id }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>

            <section class="funding-section">
                <div class="funding-header">
                    <div>
                        <h3>International Funding / Collaborations / Others</h3>
                        <p class="funding-kicker">Global partnerships and cross-institutional initiatives.</p>
                    </div>
                    <span class="funding-count">{{ site.data.rafael.funding.international | size }} awards</span>
                </div>
                <div class="funding-list">
                    {% for n in site.data.rafael.funding.international %}
                    <div class="funding-item">
                        <div class="funding-period">{{ n.period }}</div>
                        <div class="funding-body">
                            {% if n.link %}
                            <a class="funding-title" href="{{ n.link }}" target="_blank">{{ n.title }}</a>
                            {% else %}
                            <div class="funding-title">{{ n.title }}</div>
                            {% endif %}
                            <div class="funding-meta">
                                <span class="funding-amount">{{ n.amount }}</span>
                                <span>— {{ n.program }}</span>
                            </div>
                            {% if n.awards %}
                            <div class="funding-awards">
                                {% for d in n.awards %}
                                <span>#{{ d.id }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
        </div>
        
        {% include footer.html %}
    </div>
</section>
